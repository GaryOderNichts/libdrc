<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Wi-Fi Peculiarities &#8212; libdrc project</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b20cc3f5" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=eeb27264" />
    <link rel="stylesheet" href="../../_static/bootstrap-3.0.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-3.0.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <script src="../../_static/documentation_options.js?v=2709fde1"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/jquery-1.9.1.min.js"></script>
    <script src="../../_static/js/jquery-fix.js"></script>
    <script src="../../_static/bootstrap-3.0.0/js/bootstrap.min.js"></script>
    <script src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Network services" href="services.html" />
    <link rel="prev" title="GamePad boot process" href="boot.html" />
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">

<link rel="icon" type="image/x-icon" href="../../_static/favicon.ico" />
<link rel="shortcut icon" type="image/x-icon" href="../../_static/favicon.ico" />

  </head><body>

  <div id="navbar" class="navbar-inverse navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        
        <a class="navbar-brand" href="../../index.html" title="libdrc home">
          <img class="logo" src="../../_static/logo_pixel.svg" width="110" height="40" alt="libdrc" onerror="this.removeAttribute('onerror'); this.src='../../_static/logo_pixel.png'" />
        </a>
        
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            <li ><a href="../../download.html">Download</a></li>
            
            <li ><a href="../../examples.html">Examples</a></li>
            
            <li class="active"><a href="../index.html">Documentation</a></li>
            
            <li ><a href="../../development.html">Development</a></li>
            
            <li ><a href="../../support.html">Support</a></li>
            
            
          </ul>

          
        </div>
    </div>
  </div>

<div id="overall">
<div class="container">
    <div class="row">
    <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Wi-Fi Peculiarities</a><ul>
<li><a class="reference internal" href="#pairing">Pairing</a></li>
<li><a class="reference internal" href="#normal-connection-and-wpa2">Normal connection and WPA2</a></li>
<li><a class="reference internal" href="#analysis-tools">Analysis tools</a></li>
</ul>
</li>
</ul>
<div class="row text-right">
    <a href="boot.html" class="btn btn-default"
        title="Previous Chapter: GamePad boot process"><i class="fa fa-arrow-left"></i> GamePad boot process</a>
    <a href="services.html" class="btn btn-default"
        title="Next Chapter: Network services">Network services <i class="fa fa-arrow-right"></i> </a>
</div>
  <a href="../../_sources/docs/re/wifi.rst.txt"
     rel="nofollow"><i class="fa fa-file-text nostyle"></i> Source of this page</a>
<form action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
    </div>
        <div class="col-md-9">
            
  <section id="wi-fi-peculiarities">
<h1>Wi-Fi Peculiarities<a class="headerlink" href="#wi-fi-peculiarities" title="Link to this heading">¶</a></h1>
<p>DRC communicates with DRH using 5GHz 802.11n. Pairing uses a slightly modified
version of WPS, normal connection encryption uses a slight modified version of
WPA2.</p>
<section id="pairing">
<h2>Pairing<a class="headerlink" href="#pairing" title="Link to this heading">¶</a></h2>
<p>When the console is in GamePad pairing mode (press twice on the SYNC button),
it exposes an open access point named <code class="docutils literal notranslate"><span class="pre">WiiU&lt;mac2&gt;&lt;mac&gt;_STA1</span></code> (where <code class="docutils literal notranslate"><span class="pre">&lt;mac&gt;</span></code>
is the adapter MAC address and <code class="docutils literal notranslate"><span class="pre">&lt;mac2&gt;</span></code> almost the adapter MAC address). The
GamePad connects to this access point (<strong>TODO</strong>: how does it choose the AP to
connect to?) and initiates a WPS handshake to get the credentials for the
normal communication mode.</p>
<p>Nintendo modified the WPS handshake slightly to obfuscate the protocol: a
normal WPS implementation will not compute the same <em>AuthKey</em> and fail at stage
M2. The standard specifies that the AuthKey is computed from <code class="docutils literal notranslate"><span class="pre">KDF(KDK)</span></code>. In
Nintendo’s implementation, <em>AuthKey</em> is computed from <code class="docutils literal notranslate"><span class="pre">KDF(KDK_ROT)</span></code> where
<code class="docutils literal notranslate"><span class="pre">KDK_ROT</span></code> is <code class="docutils literal notranslate"><span class="pre">KDK</span></code> rotated 3 bytes to the left.</p>
<img alt="../../_images/drc-obfu.png" src="../../_images/drc-obfu.png" />
<p>The WPS handhake uses a PIN code which must be the same on console and GamePad.
When pairing, the console displays the first part of the code on the TV screen
using symbols: ♠ = 0, ♥ = 1, ♦ = 2, ♣ = 3. The second part of the PIN is
hardcoded to <code class="docutils literal notranslate"><span class="pre">5678</span></code>. For example, if the console displays ♠♠♦♣, the PIN is
<code class="docutils literal notranslate"><span class="pre">00235678</span></code>. If you are trying to associate a gamepad to your computer (and
not your computer to a Wii U), you get to choose the code, as long as you enter
the same on the GamePad it should work.</p>
<p>After the WPS handshake is done, you should get the Wii U SSID, BSSID (AP MAC
address) and PSK.</p>
</section>
<section id="normal-connection-and-wpa2">
<h2>Normal connection and WPA2<a class="headerlink" href="#normal-connection-and-wpa2" title="Link to this heading">¶</a></h2>
<p>In normal operation mode (not pairing), the Wii U exposes a <em>WPA2-PSK</em> access
point with an empty SSID. In the beacon frames it broadcasts, the AP advertises
support for these ciphers:</p>
<ul class="simple">
<li><p>Pairwise: <code class="docutils literal notranslate"><span class="pre">a4:c0:e1</span></code> (Nintendo OUI) AES CCM</p></li>
<li><p>Group: <code class="docutils literal notranslate"><span class="pre">a4:c0:e1</span></code> (Nintendo OUI) AES CCM</p></li>
<li><p>Auth key mgmt: <code class="docutils literal notranslate"><span class="pre">a4:c0:e1</span></code> (Nintendo OUI) PSK</p></li>
</ul>
<p>Note that because these are not the standard RSN algorithms, you may have
trouble getting your supplicant to associate with the AP: it needs to advertise
the support for these algorithms or the Wii U will refuse your connection with
error code 0x000c.</p>
<p>The only difference between the Nintendo Pairwise CCM and the standard pairwise
CCM is a 3 bytes rotation of the <code class="docutils literal notranslate"><span class="pre">PTK</span></code> to the left after it’s computed.</p>
<p>After that, the GamePad sends a DHCP request and the console answers it with an
IP (default: <code class="docutils literal notranslate"><span class="pre">console=192.168.1.10</span> <span class="pre">gamepad=192.168.1.11</span></code>).</p>
</section>
<section id="analysis-tools">
<h2>Analysis tools<a class="headerlink" href="#analysis-tools" title="Link to this heading">¶</a></h2>
<p>A patched version of Wireshark that has support for the modified Nintendo
ciphers is available on <a class="reference external" href="https://bitbucket.org/memahaxx/drc-wireshark">memahaxx/drc-wireshark</a>.</p>
</section>
</section>


        </div>
          
        
            <div class="row text-right">
    <a href="boot.html" class="btn btn-default"
        title="Previous Chapter: GamePad boot process"><i class="fa fa-arrow-left"></i> GamePad boot process</a>
    <a href="services.html" class="btn btn-default"
        title="Next Chapter: Network services">Network services <i class="fa fa-arrow-right"></i> </a>
</div>
        
    </div>
</div>
</div>
<footer>
    <div class="container">
        <div class="row">
            <div class="col-md-4">
                        &copy; Copyright 2013, Mema Hacking.<br/>
                    Powered by <a href="http://sphinx.pocoo.org/">Sphinx</a> 7.2.6.<br/>
            </div>

            <div class="col-md-4">
            </div>

            <div class="col-md-4">
                <a href="#">Back to top</a>
                
                    <br/>
                    
  <a href="../../_sources/docs/re/wifi.rst.txt"
     rel="nofollow"><i class="fa fa-file-text nostyle"></i> Source of this page</a>
                
            </div>

        </div>
    </div>
</footer>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46672635-1', 'libdrc.org');
  ga('send', 'pageview');
</script>
  </body>
</html>